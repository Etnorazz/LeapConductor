<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.10: http://docutils.sourceforge.net/" />
<title>Understanding the Python Sample Application</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id$
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="understanding-the-python-sample-application">
<h1 class="title">Understanding the Python Sample Application</h1>

<p><em>Notice: This developer release of Leap Motion, Inc. software is confidential and intended for very limited distribution. Parties using this software must accept the SDK Agreement prior to obtaining this software and related documentation. This software and documentation are subject to copyright.</em></p>
<hr class="docutils" />
<p>This article discusses the Python sample application included with the Leap SDK. After reading this article, you should be ready to access Leap hand tracking data from your own Python applications.</p>
<div class="contents topic" id="topics">
<p class="topic-title first">Topics:</p>
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id1">Overview</a></li>
<li><a class="reference internal" href="#creating-a-controller-object" id="id2">Creating a Controller object</a></li>
<li><a class="reference internal" href="#subclassing-the-listener-class" id="id3">Subclassing the Listener class</a></li>
<li><a class="reference internal" href="#getting-a-frame-of-data" id="id4">Getting a Frame of data</a></li>
<li><a class="reference internal" href="#running-the-sample" id="id5">Running the sample</a></li>
</ul>
</div>
<p>In the Leap SDK folder, you can find the following files used for this article:</p>
<ul class="simple">
<li><tt class="docutils literal">Leap_SDK/sample/Sample.py</tt> — Python sample application</li>
<li><tt class="docutils literal">Leap_SDK/lib/Leap.py</tt> — Leap Python API class definitions</li>
<li><tt class="docutils literal">Leap_SDK/lib/x86/_LeapPython.pyd</tt> — 32-bit Leap Python library for Windows</li>
<li><tt class="docutils literal">Leap_SDK/lib/x64/_LeapPython.pyd</tt> — 64-bit Leap Python library for Windows</li>
<li><tt class="docutils literal">Leap_SDK/lib/_LeapPython.so</tt> — Leap Python library for Mac</li>
<li><tt class="docutils literal">Leap_SDK/lib/x86/Leap.dll</tt> — 32-bit Leap library for Windows</li>
<li><tt class="docutils literal">Leap_SDK/lib/x64/Leap.dll</tt> — 64-bit Leap library for Windows</li>
<li><tt class="docutils literal">Leap_SDK/lib/libLeap.dylib</tt> — Leap library for Mac</li>
</ul>
<p>Also note that you can find the Leap API reference documentation at <a class="reference external" href="API_Reference/annotated.html">Leap_SDK/docs/API_Reference/annotated.html</a>.</p>
<div class="section" id="overview">
<h1><a class="toc-backref" href="#id1">Overview</a></h1>
<p>In a nutshell, the Leap motion tracking device detects and tracks hands and fingers placed within its field of view. The Leap captures this data one <em>frame</em> at a time. Your applications can use the Leap API to access this data.</p>
<p>The sample application demonstrates how to use the Leap API to listen for frame events dispatched by the Leap and how to access the hand and finger data in each frame. The application is a small command-line program that prints information about detected hands and fingers to standard output. The application is contained in a single file, <tt class="docutils literal">Sample.py</tt>.</p>
<p>The sample application uses most of the key classes in the Leap API, including:</p>
<ul class="simple">
<li><tt class="docutils literal">Leap.Controller</tt> — the interface between the Leap and your application</li>
<li><tt class="docutils literal">Leap.Listener</tt> — used to handle events dispatched by the Leap</li>
<li><tt class="docutils literal">Leap.Frame</tt> — contains a set of hand and finger tracking data</li>
<li><tt class="docutils literal">Leap.Hand</tt> — contains tracking data for a detected hand</li>
<li><tt class="docutils literal">Leap.Finger</tt> — contains tracking data for a detected finger</li>
<li><tt class="docutils literal">Leap.Ball</tt> — represents a sphere with a position and radius</li>
<li><tt class="docutils literal">Leap.Ray</tt> — represents a 3D vector with position and direction</li>
<li><tt class="docutils literal">Leap.Vector</tt> — represents a 3D position or directional vector</li>
</ul>
<p>For more detailed information about these classes, pleases refer to the Leap API reference documentation.</p>
</div>
<div class="section" id="creating-a-controller-object">
<h1><a class="toc-backref" href="#id2">Creating a Controller object</a></h1>
<p>The <tt class="docutils literal">Controller</tt> class provides the main interface between the Leap and your application. When you create a Controller object, it connects to the Leap software running on the computer and makes hand tracking data available through <tt class="docutils literal">Frame</tt> objects. You can access these Frame objects by instantiating a Controller object and calling the <tt class="docutils literal">Controller.frame</tt> function.</p>
<p>To receive notification when a new frame is available, you can set up an event listener by passing an instance of a subclass of the <tt class="docutils literal">Listener</tt> class to the Controller constructor. When a listener is provided, the controller calls the relevant callback function implemented in your Listener subclass when the Leap dispatches an event. The most interesting is the <tt class="docutils literal">onFrame</tt> event, which is dispatched when a new frame of hand tracking data is available.</p>
<p>The sample application creates a Controller object in its <tt class="docutils literal">main</tt> function, passing an instance of a Listener subclass to the Controller constructor:</p>
<pre class="literal-block">
def main():
  # Create a sample listener and assign it to a controller to receive events
  listener = SampleListener()
  controller = Leap.Controller(listener)

  # Keep this process running until Enter is pressed
  print &quot;Press Enter to quit...&quot;
  sys.stdin.readline()

  # The controller must be disposed of before the listener
  controller = None
</pre>
<p>The application then runs until you press the Enter key. In the meantime, the controller calls the appropriate listener callback functions when events occur.</p>
</div>
<div class="section" id="subclassing-the-listener-class">
<h1><a class="toc-backref" href="#id3">Subclassing the Listener class</a></h1>
<p>The sample application defines a <tt class="docutils literal">Listener</tt> subclass, SampleListener, which implements callback functions to handle events dispatched by the Leap. The events include:</p>
<ul class="simple">
<li><tt class="docutils literal">onInit</tt> — dispatched once, when the controller to which the listener is registered is initialized.</li>
<li><tt class="docutils literal">onConnect</tt> — dispatched when the controller connects to the Leap and is ready to begin sending frames of motion tracking data.</li>
<li><tt class="docutils literal">onDisconnect</tt> — dispatched if the controller disconnects from the Leap (for example, if you unplug the Leap device or shut down the Leap software).</li>
<li><tt class="docutils literal">onFrame</tt> — dispatched when a new frame of motion tracking data is available.</li>
</ul>
<p>In the three lifecycle event callbacks, <tt class="docutils literal">onInit</tt>, <tt class="docutils literal">onConnect</tt>, and <tt class="docutils literal">onDisconnect</tt>, the sample application simply prints a message to standard output. For the <tt class="docutils literal">onFrame</tt> event, the listener callback does a bit more work. When the controller calls the <tt class="docutils literal">onFrame</tt> callback, the function gets the latest frame of motion tracking data and prints information about the detected objects to standard output.</p>
</div>
<div class="section" id="getting-a-frame-of-data">
<h1><a class="toc-backref" href="#id4">Getting a Frame of data</a></h1>
<p>The Controller calls the <tt class="docutils literal">onFrame</tt> callback function when the Leap generates a new frame of motion tracking data.  You can access the new data by calling the <tt class="docutils literal">Controller.frame</tt> function, which returns the newest Frame object. (A reference to the Controller object is passed to the callback as a parameter.) A Frame object contains an ID, a timestamp, and a list containing a Hand object for each physical hand in view.</p>
<p>The following code from the sample application’s <tt class="docutils literal">onFrame</tt> implementation gets the most recent Frame object from the controller, retrieves the list of Hands from the Frame and then prints out the Frame ID, timestamp, and the number of Hands in the list:</p>
<pre class="literal-block">
# Get the most recent frame and report some basic information
frame = controller.frame()
hands = frame.hands()
numHands = len(hands)
print &quot;Frame id: %d, timestamp: %d, hands: %d&quot; % (
      frame.id(), frame.timestamp(), numHands)
</pre>
<p>The function goes on to examine the first Hand in the list:</p>
<pre class="literal-block">
if numHands &gt;= 1:
  # Get the first hand
  hand = hands[0]
</pre>
<p>A Hand object contains an ID, a Ray object representing the palm of the hand, and a list of Finger objects. Each Finger object contains an ID and a Ray object representing the finger tip. (Velocities for the palm and finger tip are also available, but not used in this sample.) The Leap Python API stores Hand and Finger objects in list-like objects: HandArray and FingerArray. Use the <tt class="docutils literal">list[index]</tt> syntax to get elements from these objects. Use the <tt class="docutils literal">len(list)</tt> function to get the number of elements.</p>
<p>Once it has retrieved a hand, the function checks it for fingers:</p>
<pre class="literal-block">
# Check if the hand has any fingers
fingers = hand.fingers()
numFingers = len(fingers)
</pre>
<p>And then averages the finger tip positions, printing the result and the number of fingers:</p>
<pre class="literal-block">
if numFingers &gt;= 1:
  # Calculate the hand's average finger tip position
  pos = Leap.Vector(0, 0, 0)
  for finger in fingers:
    tip = finger.tip()
    pos.x += tip.position.x
    pos.y += tip.position.y
    pos.z += tip.position.z
  pos = Leap.Vector(pos.x/numFingers, pos.y/numFingers, pos.z/numFingers)
  print &quot;Hand has %d fingers with average tip position (%f, %f, %f)&quot; % (
        numFingers, pos.x, pos.y, pos.z)
</pre>
<p>To print the hand's palm position, the onFrame function gets a Ray object from the hand.palm() function:</p>
<pre class="literal-block">
# Check if the hand has a palm
palmRay = hand.palm()
if palmRay is not None:
  # Get the palm position and wrist direction
  palm = palmRay.position
  wrist = palmRay.direction
  print &quot;Palm position (%f, %f, %f)&quot; % (palm.x, palm.y, palm.z)
</pre>
<p>Note that the function checks to see if the palm Ray object exists before using it. Even though a hand is detected, the Leap may not be able calculate the palm ray. A Hand object will always contain at least one finger or palm. You will never receive a Hand object with both an empty finger list and no palm ray.</p>
<p>Next, the onFrame function calculates the hand's pitch, roll, and yaw angles using the hand normal vector and the wrist direction vector:</p>
<pre class="literal-block">
# Check if the hand has a normal vector
normal = hand.normal()
if normal is not None:
  # Calculate the hand's pitch, roll, and yaw angles
  pitchAngle = math.atan2(normal.z, normal.y) * 180/math.pi + 180
  rollAngle = math.atan2(normal.x, normal.y) * 180/math.pi + 180
  yawAngle = math.atan2(wrist.z, wrist.x) * 180/math.pi - 90
  # Ensure the angles are between -180 and +180 degrees
  if pitchAngle &gt; 180: pitchAngle -= 360
  if rollAngle &gt; 180: rollAngle -= 360
  if yawAngle &gt; 180: yawAngle -= 360
  print &quot;Pitch: %f degrees,  roll: %f degrees,  yaw: %f degrees&quot; % (
        pitchAngle, rollAngle, yawAngle);
</pre>
<p>Finally, the function prints out the radius of a sphere fit to the hand's curvature:</p>
<pre class="literal-block">
# Check if the hand has a ball
ball = hand.ball();
if ball is not None:
  print &quot;Hand curvature radius: %f mm&quot; % ball.radius
</pre>
</div>
<div class="section" id="running-the-sample">
<h1><a class="toc-backref" href="#id5">Running the sample</a></h1>
<p>To run the sample application:</p>
<ol class="arabic simple">
<li>Plug the Leap device into a USB port and place it in front of you.</li>
<li>If you haven’t already, install the Leap software.</li>
<li>Start the Leap software. If you haven’t already, enter your registered email address and password when prompted. The Leap icon appears in the notification area of the task bar (on Windows) or finder bar (on Mac) and turns green when ready.</li>
<li>Run the sample application:</li>
</ol>
<blockquote>
<ul>
<li><p class="first">On Windows, make sure that <tt class="docutils literal">Sample.py</tt>, <tt class="docutils literal">Leap.py</tt>, <tt class="docutils literal">_LeapPython.pyd</tt>, and <tt class="docutils literal">Leap.dll</tt> are in the current directory. If you are using a 32-bit version of Python, use the .pyd and .dll files from the <tt class="docutils literal">lib\x86</tt> folder of the SDK. Use the .pyd and .dll files from <tt class="docutils literal">lib\x64</tt> with 64-bit Python. Run the following command in a command-line prompt:</p>
<p><tt class="docutils literal">python Sample.py</tt></p>
</li>
<li><p class="first">On Mac, make sure that <tt class="docutils literal">Sample.py</tt>, <tt class="docutils literal">Leap.py</tt>, <tt class="docutils literal">_LeapPython.so</tt>, and <tt class="docutils literal">libLeap.dylib</tt> are in the current directory and run the following command in a terminal window:</p>
<p><tt class="docutils literal">python Sample.py</tt></p>
</li>
</ul>
</blockquote>
<p>You should see the messages &quot;Initialized&quot; and &quot;Connected&quot; printed to standard output when the application initializes and connects to the Leap. You should then see frame information printed each time the Leap dispatches the <tt class="docutils literal">onFrame</tt> event. When you place a hand above the Leap, you should also see finger and palm position information printed.</p>
<p>Now that you have seen how to access motion tracking data from the Leap, you can begin developing your own Python applications that integrate the Leap.</p>
<hr class="docutils" />
<p>Copyright © 2012 Leap Motion, Inc. All rights reserved.</p>
</div>
</div>
</body>
</html>
